#SQL
#Pull total number of orders that were completed on 18th March 2023
SELECT COUNT(*) AS total_orders
FROM SALES
WHERE Date = '2023-03-18';

#Pull total number of orders that were completed on 18th March 2023 with the first name ‘John’ and last name Doe’
SELECT COUNT(*) AS john_doe_orders
FROM SALES S
JOIN CUSTOMERS C ON S.Customer_id = C.Customer_id
WHERE S.Date = '2023-03-18'
  AND C.First_name = 'John'
  AND C.Last_name = 'Doe';

#Pull total number of customers that purchased in January 2023 and the average amount spend per customer
SELECT 
    COUNT(DISTINCT Customer_id) AS total_customers,
    AVG(total_spent) AS avg_spent_per_customer
FROM (
    SELECT Customer_id, SUM(Revenue) AS total_spent
    FROM SALES
    WHERE MONTH(Date) = 1 AND YEAR(Date) = 2023
    GROUP BY Customer_id
) AS spending_summary;

#Pull the departments that generated less than $600 in 2022
SELECT I.Department, SUM(S.Revenue) AS department_revenue
FROM SALES S
JOIN ITEMS I ON S.Item_id = I.Item_id
WHERE YEAR(S.Date) = 2022
GROUP BY I.Department
HAVING SUM(S.Revenue) < 600;

#What is the most and least revenue we have generated by an order
SELECT MAX(order_total) AS most_revenue,
       MIN(order_total) AS least_revenue
FROM (
    SELECT Order_id, SUM(Revenue) AS order_total
    FROM SALES
    GROUP BY Order_id
) AS order_summary;

#What were the orders that were purchased in our most lucrative order
WITH OrderTotals AS (
    SELECT Order_id, SUM(Revenue) AS total
    FROM SALES
    GROUP BY Order_id
),
TopOrder AS (
    SELECT Order_id
    FROM OrderTotals
    WHERE total = (SELECT MAX(total) FROM OrderTotals)
)
SELECT *
FROM SALES
WHERE Order_id IN (SELECT Order_id FROM TopOrder);
